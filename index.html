<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wizard Chess</title>
    <link rel="stylesheet" href="css/style.css" />
    <!-- Chess.js library for game logic -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
  </head>
  <body>
    <div class="game-container">
      <header>
        <h1>Wizard Chess</h1>
      </header>

      <div class="game-area">
        <div class="board-container">
          <div id="board" class="chess-board"></div>
          <div id="promotion-selection" class="hidden">
            <div class="promotion-piece" data-piece="q"></div>
            <div class="promotion-piece" data-piece="r"></div>
            <div class="promotion-piece" data-piece="b"></div>
            <div class="promotion-piece" data-piece="n"></div>
          </div>
        </div>
        <div class="side-panel">
          <div class="difficulty-selector">
            <h3>Bot Difficulty</h3>
            <select id="difficulty">
              <option value="1">Apprentice</option>
              <option value="2" selected>Adept</option>
              <option value="3">Master</option>
              <option value="4">Archmage</option>
            </select>
          </div>

          <div class="status-board">
            <div id="game-status">White to move</div>
            <div id="captured-pieces">
              <div id="captured-black" class="captured"></div>
              <div id="captured-white" class="captured"></div>
            </div>
          </div>

          <div class="move-history">
            <h3>Spell History</h3>
            <div id="moves" class="moves-list"></div>
          </div>

          <div class="game-controls">
            <button id="new-game">New Game</button>
            <button id="undo-move">Undo Move</button>
            <button id="hint">Hint</button>
          </div>
        </div>
      </div>

      <div id="game-over-modal" class="modal hidden">
        <div class="modal-content">
          <h2 id="game-result">Game Over</h2>
          <p id="result-message"></p>
          <button id="new-game-modal">New Game</button>
        </div>
      </div>
    </div>

    <script>
      // Check if Chess.js loaded properly
      window.addEventListener("load", function () {
        if (typeof Chess === "undefined") {
          console.error("Chess.js failed to load");
          alert(
            "Failed to load chess engine. Please check your internet connection and try again."
          );
        } else {
          console.log("Chess.js loaded successfully");
        }
      });
    </script>
    <script src="js/board.js"></script>
    <script src="js/engine.js"></script>
    <script src="js/game.js"></script>

    <script>
      // Immediate fix to hide the game over modal on page load
      document.addEventListener("DOMContentLoaded", function () {
        console.log("Hiding game over modal on page load");
        const gameOverModal = document.getElementById("game-over-modal");
        if (gameOverModal) {
          gameOverModal.classList.add("hidden");
        }
      });
    </script>

    <script>
      // Force fix for any UI or game state issues
      window.addEventListener("load", function () {
        console.log("Window loaded - applying direct fixes");

        // Hide the game over modal with direct DOM manipulation
        const gameOverModal = document.getElementById("game-over-modal");
        if (gameOverModal) {
          gameOverModal.classList.add("hidden");
          gameOverModal.style.display = "none";
        }

        // Force a new game start after a short delay
        setTimeout(function () {
          if (window.game && typeof window.game.resetGame === "function") {
            window.game.resetGame();
            console.log("Forced game reset after page load");
          }
        }, 300);
      });
    </script>
  </body>
</html>
